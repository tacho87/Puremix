#!/usr/bin/env bash

# PureMix CLI Launcher
# This script runs the PureMix CLI with Node.js 22+ native TypeScript support

# Resolve the real path of this script (handles npm global installation symlinks)
REAL_SCRIPT_PATH="$(readlink -f "$0")"

# Get the package directory from the script's real path
PACKAGE_DIR="$( dirname "$REAL_SCRIPT_PATH" )"

# Path to the CLI TypeScript file (for development) or JavaScript file (for built package)
CLI_FILE="$PACKAGE_DIR/cli/puremix.ts"
if [ ! -f "$CLI_FILE" ]; then
    CLI_FILE="$PACKAGE_DIR/cli/puremix.js"
fi

# Verify the CLI file exists before trying to run it
if [ ! -f "$CLI_FILE" ]; then
    echo "‚ùå Error: Cannot find PureMix CLI at $CLI_FILE"
    echo "üìÅ Package directory: $PACKAGE_DIR"
    echo "üîç Script path: $REAL_SCRIPT_PATH"
    echo ""
    echo "This usually indicates a broken installation. Try:"
    echo "  npm uninstall -g puremix"
    echo "  npm install -g puremix"
    echo "Or use without installation:"
    echo "  npx puremix create my-app"
    exit 1
fi

# Run the CLI with appropriate runner
if [[ "$CLI_FILE" == *.ts ]]; then
    # Use tsx for TypeScript files
    exec npx tsx "$CLI_FILE" "$@"
else
    # Use node for JavaScript files (production builds)
    exec node "$CLI_FILE" "$@"
fi