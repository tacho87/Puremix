<loader>
  async function loadMetricsWidget(request, actionResult) {
    const metricType = request.props.metricType || 'revenue';
    const title = request.props.title || 'Metric';
    const value = request.props.value || 0;
    const change = request.props.change || 0;
    const period = request.props.period || 'This Month';
    const icon = request.props.icon || 'chart';

    // Determine colors based on metric type and change
    let bgColor = 'bg-blue-500';
    let iconColor = 'text-blue-500';

    if (metricType === 'profit') {
      bgColor = 'bg-green-500';
      iconColor = 'text-green-500';
    } else if (metricType === 'expenses') {
      bgColor = 'bg-red-500';
      iconColor = 'text-red-500';
    } else if (metricType === 'users') {
      bgColor = 'bg-purple-500';
      iconColor = 'text-purple-500';
    }

    // Format value based on magnitude
    let formattedValue = '';
    if (value >= 1000000) {
      formattedValue = '$' + (value / 1000000).toFixed(1) + 'M';
    } else if (value >= 1000) {
      formattedValue = '$' + (value / 1000).toFixed(0) + 'K';
    } else if (typeof value === 'number') {
      formattedValue = value.toLocaleString();
    } else {
      formattedValue = value.toString();
    }

    // Format change percentage
    const changeValue = parseFloat(change) || 0;
    const isPositive = changeValue >= 0;
    const changeColor = isPositive ? 'text-green-600' : 'text-red-600';

    return {
      data: {
        title,
        formattedValue,
        changeValue,
        changeColor,
        period,
        icon,
        bgColor,
        iconColor
      }
    };
  }
</loader>

<div class="bg-white rounded-lg shadow p-6 hover:shadow-lg transition-shadow">
  <div class="flex items-center justify-between">
    <div class="flex-1">
      <p class="text-sm font-medium text-gray-600">{loadMetricsWidget.data.title}</p>
      <p class="text-2xl font-bold text-gray-900 mt-2">{loadMetricsWidget.data.formattedValue}</p>
      <div class="flex items-center mt-2">
        <svg class={`w-4 h-4 ${loadMetricsWidget.data.changeColor} mr-1`} fill="currentColor" viewBox="0 0 20 20">
          {loadMetricsWidget.data.changeValue >= 0 ?
            `<path fill-rule="evenodd" d="M5.293 9.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 7.414V15a1 1 0 11-2 0V7.414L6.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd" />`
          :
            `<path fill-rule="evenodd" d="M14.707 10.293a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 111.414-1.414L9 12.586V5a1 1 0 012 0v7.586l2.293-2.293a1 1 0 011.414 0z" clip-rule="evenodd" />`
          }
        </svg>
        <span class={`text-sm font-medium ${loadMetricsWidget.data.changeColor}`}>
          {Math.abs(loadMetricsWidget.data.changeValue)}%
        </span>
        <span class="text-sm text-gray-500 ml-2">{loadMetricsWidget.data.period}</span>
      </div>
    </div>
    <div class="flex-shrink-0">
      <div class={`w-12 h-12 rounded-lg ${loadMetricsWidget.data.bgColor} bg-opacity-10 flex items-center justify-center`}>
        <!-- Icon based on type -->
        {loadMetricsWidget.data.icon === 'dollar' ?
          `<svg class="w-6 h-6 ${loadMetricsWidget.data.iconColor}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>`
        : loadMetricsWidget.data.icon === 'chart' ?
          `<svg class="w-6 h-6 ${loadMetricsWidget.data.iconColor}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
          </svg>`
        : loadMetricsWidget.data.icon === 'receipt' ?
          `<svg class="w-6 h-6 ${loadMetricsWidget.data.iconColor}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
          </svg>`
        :
          `<svg class="w-6 h-6 ${loadMetricsWidget.data.iconColor}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
          </svg>`
        }
      </div>
    </div>
  </div>
</div>